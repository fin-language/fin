// AUTOGENERATED FILE. Do not modify this file manually, it will be overwritten.
// finlang v0.3.0-alpha generated this file for C# `hal.DigOutputFromShiftReg` type.
// Source file: `LedBlinker/hal/shift/DigOutputFromShiftReg.cs` (relative to C# solution).
// MD5 hash of source file: 2903175a5f90418fb31a3d2fa5fce861.


#include "hal_DigOutputFromShiftReg.h"
#include "hal_BitHelper.h"
#include <string.h>



/// <summary>
/// When we support constexpr, we should pass bit index instead of bit mask.
/// </summary>
/// <param name="shift_data"></param>
/// <param name="bit_mask"></param>
/// <exception cref="System.ArgumentException"></exception>
void hal_DigOutputFromShiftReg_ctor(hal_DigOutputFromShiftReg * self, hal_TxShiftData * shift_data, uint8_t bit_mask)
{
    memset(self, 0, sizeof(*self));
    self->_shift_data = shift_data;
    self->_bit_mask = bit_mask;

    hal_BitHelper_SimOnlyEnsureSingleBitInMask(bit_mask);
}

bool hal_DigOutputFromShiftReg_get_output_state(hal_DigOutputFromShiftReg * self)
{
    return (hal_TxShiftData_get_tx_data(self->_shift_data) & self->_bit_mask) > 0;
}

/// <summary>
/// NOT THREAD SAFE!!!
/// </summary>
/// <param name="state"></param>
void hal_DigOutputFromShiftReg_set_output_state(hal_DigOutputFromShiftReg * self, bool state)
{
    uint8_t data = hal_TxShiftData_get_tx_data(self->_shift_data);
    if (state)
    {
        data |= self->_bit_mask;
    }
    else
    {
        data &= ~self->_bit_mask;
    }
    hal_TxShiftData_set_tx_data(self->_shift_data, data);
}

void hal_DigOutputFromShiftReg_toggle(hal_DigOutputFromShiftReg * self)
{
    if (hal_DigOutputFromShiftReg_get_output_state(self))
    {
        hal_DigOutputFromShiftReg_set_output_state(self, false);
    }
    else
    {
        hal_DigOutputFromShiftReg_set_output_state(self, true);
    }
}

// virtual table implementation for IDigOut. Note that this is extern'd.
const hal_IDigOut_vtable hal_IDigOut_vtable_imp = {
    .set_output_state = (void (*)(void * self, bool state))hal_DigOutputFromShiftReg_set_output_state,
    .get_output_state = (bool (*)(void * self))hal_DigOutputFromShiftReg_get_output_state,
    .toggle = (void (*)(void * self))hal_DigOutputFromShiftReg_toggle,
};

